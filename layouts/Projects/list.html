{{ define "main" }}
<!-- DEBUG: PROJECTS TEMPLATE LOADED -->
<div style="background: red; color: white; padding: 1rem; margin: 2rem 0; border: 2px solid darkred;">
    <strong>DEBUG: PROJECTS TEMPLATE IS LOADED!</strong><br>
    Template: layouts/Projects/list.html<br>
    Current Page: {{ .Title }}<br>
    Page Type: {{ .Type }}<br>
    Page Kind: {{ .Kind }}<br>
    Sections Count: {{ len .Sections }}
</div>

<!-- DEBUG: Show sections details -->
<div style="background: yellow; padding: 1rem; margin: 2rem 0; border: 2px solid orange;">
    <strong>DEBUG SECTIONS:</strong><br>
    {{ if .Sections }}
        Sections found ({{ len .Sections }}):
        {{ range .Sections }}
            <div style="margin: 0.5rem 0; padding: 0.5rem; background: #fff8dc; border: 1px solid #ccc;">
                <strong>{{ .Title }}</strong><br>
                Path: {{ .File.Path }}<br>
                Pages in this section: {{ len .Pages }}<br>
                {{ if .Params.people }}People: {{ delimit .Params.people ", " }}{{ end }}
            </div>
        {{ end }}
    {{ else }}
        <strong>NO SECTIONS FOUND!</strong><br>
        This means Hugo doesn't recognize your project folders as sections.<br>
        Current path: {{ .File.Path }}<br>
        Kind: {{ .Kind }}<br>
        Type: {{ .Type }}<br>
        RegularPages: {{ len .RegularPages }}
    {{ end }}
</div>

<article class="post">
    <header>
        <h1>{{ .Title }}</h1>
    </header>
    {{ .Content }}

    <!-- This is the container for our collapsible project list -->
    <div class="projects-hierarchy">
        <!-- Range through all the main project sections (the folders) -->
        {{ range .Sections.ByTitle }}
            <div class="main-project">
                <!-- The clickable header for the main project -->
                <button class="collapsible" onclick="toggleCollapse(this)">
                    <h2>{{ .Title }}</h2>
                    <i class="toggle-icon">▼</i>
                </button>
                <!-- The content that will be collapsed/expanded -->
                <div class="collapsible-content">
                    <!-- SAFE People display -->
                    {{ with .Params.people }}
                        <p><strong>People:</strong> {{ delimit . ", " }}</p>
                    {{ else }}
                        <p><strong>People:</strong> <em>To be announced</em></p>
                    {{ end }}
                    
                    <!-- SAFE Description display -->
                    {{ with .Params.description }}
                        <p><strong>Description:</strong> {{ . }}</p>
                    {{ end }}
                    
                    <!-- SAFE GitHub display (already safe) -->
                    {{ if .Params.github }}<p><strong>GitHub:</strong> <a href="{{ .Params.github }}" target="_blank">{{ .Params.github }}</a></p>{{ end }}
                    
                    {{ .Content }} <!-- The main project's full description -->

                    <h3>Sub-Projects:</h3>
                    <ul>
                        <!-- Range through all the pages (sub-projects) inside this main project folder -->
                        {{ range .Pages.ByTitle }}
                            <li class="sub-project">
                                <a href="{{ .RelPermalink }}"><strong>{{ .Title }}</strong></a>
                                
                                <!-- SAFE People display for sub-projects -->
                                {{ with .Params.people }}
                                    <p><strong>People:</strong> {{ delimit . ", " }}</p>
                                {{ else }}
                                    <p><strong>People:</strong> <em>To be announced</em></p>
                                {{ end }}
                                
                                <!-- SAFE Description display for sub-projects -->
                                {{ with .Params.description }}
                                    <p>{{ . }}</p>
                                {{ end }}
                                <!-- You could add a 'Read more...' link here -->
                            </li>
                        {{ end }}
                    </ul>
                </div>
            </div>
        {{ end }}
    </div>
</article>

<!-- The JavaScript to make the collapsible sections work -->
<script>
    function toggleCollapse(button) {
        button.classList.toggle("active");
        var content = button.nextElementSibling;
        if (content.style.display === "block") {
            content.style.display = "none";
            button.querySelector('.toggle-icon').textContent = '▼';
        } else {
            content.style.display = "block";
            button.querySelector('.toggle-icon').textContent = '▲';
        }
    }
    // Optional: Open the first project by default
    // document.querySelector('.collapsible').click();
</script>
{{ end }}